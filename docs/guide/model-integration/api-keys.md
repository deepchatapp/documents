# API 密钥管理

本页面将介绍如何在 DeepChat 中安全地管理和使用各种模型的 API 密钥，确保您的账户安全和数据隐私。

## API 密钥基础

### 什么是 API 密钥

API 密钥是访问商业语言模型服务的凭证：

- **密钥作用**：相当于您账户的密码，授权应用程序使用您的账户访问模型服务
- **计费关联**：使用 API 密钥的调用会计入您的账户，并产生相应费用
- **访问控制**：确定您可以访问哪些模型和功能

### 支持的 API 密钥类型

DeepChat 支持多种模型服务的 API 密钥：

| 服务提供商 | 密钥格式 | 获取方式 | 费用模式 |
|-----------|---------|---------|---------|
| OpenAI | `sk-...` | OpenAI 开发者平台 | 按使用量计费 |
| Anthropic | `sk-ant-...` | Anthropic 控制台 | 按使用量计费 |
| Google AI | `AIza...` | Google AI Studio | 配额+按使用量计费 |
| Azure OpenAI | 多种凭证 | Azure 门户 | 按部署资源计费 |
| Cohere | `...` | Cohere 平台 | 按使用量+订阅 |
| 百度文心 | API Key + Secret Key | 百度智能云 | 按调用次数计费 |
| 阿里通义 | API Key + Secret | 阿里云 | 按调用次数计费 |
| 讯飞星火 | App ID + API Key + Secret | 讯飞开放平台 | 按调用次数计费 |

## 安全添加 API 密钥

### 添加新密钥

将 API 密钥安全地添加到 DeepChat：

1. **通过设置菜单**：
   - 设置 → 模型 → API 密钥管理
   - 点击"添加新密钥"
   - 选择服务提供商
   - 输入密钥信息
   - 命名密钥（可选，便于管理多个密钥）

2. **添加模型时**：
   - 设置 → 模型 → 添加模型
   - 选择模型提供商
   - 系统会提示输入 API 密钥
   - 选择"保存此密钥"以便重复使用

3. **批量导入**：
   - 设置 → 模型 → API 密钥 → 导入
   - 上传符合格式的 JSON 文件
   - 确认导入的密钥信息

![添加API密钥界面](https://deepchat.thinkinai.xyz/chat-screenshot.png)

*这里应放置一张添加API密钥的界面截图，显示密钥输入和配置选项。*

### 密钥存储安全

DeepChat 如何保护您的 API 密钥：

1. **本地加密存储**：
   - 密钥使用强加密算法存储在本地
   - 利用操作系统密钥链/钥匙串（可用时）
   - 加密密钥不会明文存储在配置文件中

2. **环境变量选项**：
   - 支持从环境变量读取密钥
   - 适用于团队和开发环境
   - 设置格式：`DEEPCHAT_OPENAI_KEY`, `DEEPCHAT_ANTHROPIC_KEY` 等

3. **配置文件选项**：
   - 支持从外部配置文件读取
   - 使用相对路径或绝对路径指定文件
   - 文件权限建议设为仅所有者可读

```json
// 外部配置文件示例 (api_keys.json)
{
  "openai": {
    "api_key": "sk-xxxxxxxxxxxxxxxxxxxxxxxx",
    "org_id": "org-xxxxxxxxxxxxxxxx"
  },
  "anthropic": {
    "api_key": "sk-ant-xxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "google": {
    "api_key": "AIzaxxxxxxxxxxxxxxxxxxxxxxxx"
  }
}
```

## API 密钥管理

### 密钥组织与标签

管理多个 API 密钥的方法：

1. **命名和标签**：
   - 为每个密钥添加描述性名称
   - 使用标签分类（如"生产"、"测试"、"个人"）
   - 按项目或用途组织

2. **多密钥管理**：
   - 同一服务配置多个 API 密钥
   - 设置密钥使用优先级
   - 配置密钥切换规则

3. **密钥分组**：
   - 创建密钥组，用于特定场景
   - 一键切换整组密钥
   - 适用于团队或多项目管理

### 使用限制与监控

控制 API 密钥的使用：

1. **使用限额**：
   - 设置每日/每月使用限额
   - 配置触发警告的阈值
   - 可选自动禁用超限密钥

2. **使用统计**：
   - 跟踪每个密钥的调用次数
   - 监控消耗的令牌数量
   - 估算成本和费用

3. **使用记录**：
   - 记录每次 API 调用
   - 按应用、会话或功能过滤
   - 导出使用记录进行分析

### 密钥轮换与过期

维护密钥安全的最佳实践：

1. **定期轮换**：
   - 设置密钥轮换提醒
   - 支持无缝更新密钥
   - 保留旧密钥使用历史

2. **过期管理**：
   - 为密钥设置过期日期
   - 接近过期时自动提醒
   - 处理过期密钥的策略

3. **密钥废弃**：
   - 安全移除不再使用的密钥
   - 保留使用历史和记录
   - 确认服务商端撤销

## 特定提供商设置

### OpenAI 设置

OpenAI API 密钥的特殊配置：

1. **标准 API 与 Azure**：
   - 切换标准 OpenAI API 和 Azure OpenAI
   - 配置 Azure 特定参数（资源名称、部署ID）
   - 区域和版本设置

2. **组织设置**：
   - 添加组织 ID（多组织账户）
   - 配置默认组织
   - 按项目分配组织

3. **高级选项**：
   - 配置基础 URL（代理或自托管）
   - 设置请求超时
   - 配置重试策略

```json
// OpenAI 完整配置示例
{
  "openai": {
    "api_key": "sk-xxxxxxxxxxxxxxxxxxxxxxxx",
    "org_id": "org-xxxxxxxxxxxxxxxx",
    "base_url": "https://api.openai.com/v1",
    "timeout": 30,
    "max_retries": 3
  },
  "azure_openai": {
    "api_key": "xxxxxxxxxxxxxxxxxxxxxxxx",
    "endpoint": "https://your-resource.openai.azure.com/",
    "api_version": "2023-12-01-preview",
    "deployments": {
      "gpt4": "your-gpt4-deployment",
      "gpt35": "your-gpt35-deployment"
    }
  }
}
```

### Anthropic 设置

Anthropic API 密钥的特殊配置：

1. **区域设置**：
   - 配置 API 区域（如有要求）
   - 设置区域特定终结点
   - 合规性设置

2. **版本控制**：
   - 选择 API 版本
   - 标准 API 与企业 API 切换
   - 设置模型版本偏好

3. **使用限制**：
   - 配置请求速率限制
   - 设置并发请求限制
   - 优先级设置（企业用户）

### 国内模型服务设置

百度、阿里等国内服务的特殊配置：

1. **多重认证**：
   - 配置 API Key 和 Secret Key
   - 应用 ID 和访问令牌设置
   - 签名生成配置

2. **服务区域**：
   - 选择服务区域和数据中心
   - 配置专有网络选项
   - 满足数据合规要求

3. **计量和配额**：
   - 查看剩余配额和使用量
   - 配置预算警报
   - 针对峰值使用的限流策略

## 高级密钥管理

### 密钥访问控制

限制 API 密钥使用权限：

1. **用户权限**：
   - 设置谁可以使用特定密钥
   - 密钥使用需要额外验证（如密码）
   - 用户组权限管理

2. **功能限制**：
   - 限制密钥可用于哪些功能
   - 设置特定模型或参数的访问权限
   - 隔离敏感操作的密钥

3. **时间限制**：
   - 设置密钥使用的时间窗口
   - 非工作时间自动禁用
   - 设置临时密钥有效期

### 密钥备份与恢复

保护密钥数据安全：

1. **安全备份**：
   - 加密导出所有密钥信息
   - 设置备份密码保护
   - 选择安全的备份位置

2. **恢复选项**：
   - 从备份文件恢复密钥
   - 选择性恢复特定密钥
   - 处理密钥冲突策略

3. **设备间同步**：
   - 配置多设备间密钥同步
   - 确保同步数据加密
   - 设备认证与授权

## 最佳实践

### 安全建议

保护 API 密钥的关键建议：

1. **密钥安全原则**：
   - 永不共享或泄露 API 密钥
   - 不要将密钥硬编码到代码中
   - 避免在不安全的通道传输密钥

2. **访问限制**：
   - 在服务提供商平台设置 IP 限制
   - 设置使用量上限防止滥用
   - 遵循最小权限原则

3. **监控与审计**：
   - 定期检查 API 使用情况
   - 留意异常使用模式
   - 设置使用通知和警报

### 成本控制

管理 API 使用成本的建议：

1. **预算设置**：
   - 设置每月预算限额
   - 配置达到预算百分比的警报
   - 可选自动禁用超出预算的服务

2. **优化策略**：
   - 为不同任务选择成本效益最佳的模型
   - 缓存常见请求结果
   - 优化提示和参数减少令牌使用

3. **使用分析**：
   - 识别高成本使用模式
   - 按功能或用户分析成本
   - 实施针对性的优化措施

## 故障排除

API 密钥相关问题的解决方案：

| 问题 | 可能原因 | 解决方案 |
|------|---------|---------|
| API 验证失败 | 密钥无效或过期；密钥格式错误 | 验证密钥正确性；在服务商平台重新生成密钥；检查有无空格或格式问题 |
| 配额超限 | 达到服务商设置的使用限制；账户余额不足 | 检查服务商控制台的限制和余额；请求提高限制；充值账户 |
| 密钥泄露 | 意外分享；代码或日志中暴露；安全漏洞 | 立即撤销并重新生成密钥；检查代码和日志；审查访问记录寻找可疑活动 |
| 区域访问问题 | 地理限制；网络问题；服务商区域设置 | 检查服务商区域配置；使用正确区域的端点；考虑网络代理或VPN |
| 权限不足 | API 密钥权限不足；账户级别限制 | 检查服务商平台的密钥权限设置；提升账户等级或权限；联系客户支持 |

## 企业密钥管理

适用于团队和企业的高级密钥管理功能：

1. **集中管理**：
   - 通过管理控制台集中配置
   - 统一部署和更新密钥
   - 按部门或项目分配密钥

2. **合规功能**：
   - 详细的访问和使用日志
   - 满足监管要求的审计跟踪
   - 敏感操作的多因素认证

3. **成本分摊**：
   - 按部门或项目追踪使用成本
   - 生成详细的使用报告
   - 实施部门预算和限额

下一步，您可以了解如何优化和监控模型[性能](./performance.md)，确保 AI 模型的高效使用。

![API密钥管理概览](https://deepchat.thinkinai.xyz/chat-screenshot.png)

*这里应放置一张API密钥管理界面的截图，显示密钥列表、安全状态和使用情况。* 